"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[524],{6565:(e,t,i)=>{var s={};i.r(s),i.d(s,{CheckRules:()=>E,Item:()=>L,JsonEditor:()=>C,ListLine:()=>f,Menu:()=>T,MenuItemList:()=>_,SelectBeautiful:()=>x,WysiwygEditor:()=>S});var a={};i.r(a),i.d(a,{bindables:()=>z,default:()=>M,dependencies:()=>N,name:()=>O,register:()=>R,template:()=>U});var n={};i.r(n),i.d(n,{bindables:()=>V,default:()=>G,dependencies:()=>H,name:()=>q,register:()=>$,template:()=>B});var r={};i.r(r),i.d(r,{bindables:()=>ee,default:()=>X,dependencies:()=>Z,name:()=>Q,register:()=>ie,template:()=>Y});var l={};i.r(l),i.d(l,{bindables:()=>oe,default:()=>re,dependencies:()=>le,name:()=>ae,register:()=>de,template:()=>ne});var o={};i.r(o),i.d(o,{Alert:()=>j,ContentManageItems:()=>K,File:()=>pe,ManageAlerts:()=>se});var h,d=i(484),c=i(7913),u=i(8322),m=i(997),g=i(9038),p=i(7099);!function(e){e.ITEM_MANAGE="/contents/{targetId}/manage-items",e.IMPORT_ASYNC_UPLOAD="/api/file/upload",e.IMPORT_ASYNC_PREVIEW="/api/file/preview?name=__name__",e.IMPORT_ASYNC_DELETE="/api/file/delete?name=__name__",e.ITEM_MANAGE_MENU_ITEM="/menu/{menuId}/manage-menu-items"}(h||(h={}));class v{constructor(){}getApiBaseUrl(){return this.apiBaseUrl||(this.apiBaseUrl=window.apiBaseUrl?window.apiBaseUrl:"cms"),this.apiBaseUrl}}class b{constructor(e=(0,g.hd)(p.xl),t=(0,g.hd)(v),i=(0,g.hd)(g.gF).scopeTo("ApiServices")){this.httpClient=e,this.configService=t,this.logger=i,this.logger.trace("constructor"),this.httpClient.configure(e=>(e.withDefaults({headers:{"X-Requested-With":"XMLHttpRequest"},credentials:"include"}).withInterceptor({request:e=>(console.log(`Requesting ${e.method} ${e.url}`),e),response:e=>(console.log(`Received ${e.status} ${e.url}`),e)}).rejectErrorResponses(),e))}postForm(e,t){return this.httpClient.fetch(e,{method:"POST",body:t}).then(e=>e.text())}delete(e){return this.httpClient.fetch(e,{method:"DELETE"}).then(e=>e.text())}manageMenuItems(e,t){const i=this.configService.getApiBaseUrl()+h.ITEM_MANAGE_MENU_ITEM.replace("{menuId}",e.toString());return this.httpClient.fetch(i,{method:"POST",body:JSON.stringify(t),headers:{Accept:"text/html"}}).then(e=>e.text())}manageItems(e,t){const i=this.configService.getApiBaseUrl()+e;return this.httpClient.fetch(i,{method:"POST",body:t,headers:{Accept:"text/html"}}).then(e=>e.text())}}let f=(()=>{let e,t,i,s=[(0,m.U4)("cms-list-line")],a=[],n=[],r=[];return t=class{constructor(e=(0,g.hd)(g.gF).scopeTo("ListLine"),t=(0,g.hd)(g.xe),i=(0,g.hd)(m.w3),s=(0,g.hd)(b),a=(0,g.hd)(m.r_)){this.logger=e,this.ea=t,this.element=i,this.apiService=s,this.platform=a,this.id=(0,u.zF)(this,n,void 0),this.buttonDelete=(0,u.zF)(this,r),this.onDelete=e=>{if(this.logger.trace("onDelete"),e.preventDefault(),this.buttonDelete&&!0===confirm("Attention !! vous allez supprimer définitivement cet élément ?")){const e=this.buttonDelete.href;this.apiService.delete(e).then(e=>{this.platform.taskQueue.queueTask(()=>{this.platform.window.location.reload()})}).catch(e=>{this.logger.trace("Delete  ERROR",e)})}},this.logger.trace("constructor")}attached(){this.logger.trace("attached")}detached(){this.logger.trace("detached")}bound(){this.logger.trace("bound"),this.addEvent()}unbinding(){this.logger.trace("unbinding"),this.removeEvent()}addEvent(){this.logger.trace("addEvent"),this.buttonDelete=this.element.querySelector(".user-button-delete"),this.buttonDelete&&this.buttonDelete.addEventListener("click",this.onDelete)}removeEvent(){this.logger.trace("removeEvent"),this.buttonDelete&&this.buttonDelete.removeEventListener("click",this.onDelete)}onValidate(e){return this.logger.trace("onValidate"),!0}},(0,u.yV)(t,"ListLine"),(()=>{const l="function"==typeof Symbol&&Symbol.metadata?Object.create(null):void 0;i=[(0,m._t)()],(0,u.G4)(null,null,i,{kind:"field",name:"id",static:!1,private:!1,access:{has:e=>"id"in e,get:e=>e.id,set:(e,t)=>{e.id=t}},metadata:l},n,r),(0,u.G4)(null,e={value:t},s,{kind:"class",name:t.name,metadata:l},null,a),t=e.value,l&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:l}),(0,u.zF)(t,a)})(),t})(),E=(()=>{let e,t,i,s=[(0,m.U4)("cms-check-rules")],a=[],n=[],r=[];return t=class{constructor(e=(0,g.hd)(g.gF).scopeTo("CheckRules"),t=(0,g.hd)(m.w3)){this.logger=e,this.element=t,this.id=(0,u.zF)(this,n,void 0),this.mainCheck=(0,u.zF)(this,r),this.onCheckMain=e=>{if(this.logger.trace("onCheckMain"),this.mainCheck)return this.childCheck&&this.childCheck.forEach((e,t)=>{e.checked=this.mainCheck.checked}),!0},this.onCheckChild=e=>{this.logger.trace("onCheckMain");const t=e.currentTarget;if(t)return t.checked||this.mainCheck&&(this.mainCheck.checked=!1),!0},this.logger.trace("constructor")}attached(){this.logger.trace("attached"),this.mainCheck=this.element.querySelector("input.main-check"),this.childCheck=this.element.querySelectorAll("input.sub-check"),this.mainCheck&&this.mainCheck.addEventListener("click",this.onCheckMain),this.childCheck&&this.childCheck.forEach((e,t)=>{e.addEventListener("click",this.onCheckChild)})}detached(){this.logger.trace("detached"),this.mainCheck&&this.mainCheck.removeEventListener("click",this.onCheckMain),this.childCheck&&this.childCheck.forEach((e,t)=>{e.removeEventListener("click",this.onCheckChild)})}},(0,u.yV)(t,"CheckRules"),(()=>{const l="function"==typeof Symbol&&Symbol.metadata?Object.create(null):void 0;i=[(0,m._t)()],(0,u.G4)(null,null,i,{kind:"field",name:"id",static:!1,private:!1,access:{has:e=>"id"in e,get:e=>e.id,set:(e,t)=>{e.id=t}},metadata:l},n,r),(0,u.G4)(null,e={value:t},s,{kind:"class",name:t.name,metadata:l},null,a),t=e.value,l&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:l}),(0,u.zF)(t,a)})(),t})();var I=i(2782),A=i.n(I);let C=(()=>{let e,t,i,s=[(0,m.U4)("cms-json-editor")],a=[],n=[],r=[];return t=class{constructor(e=(0,g.hd)(g.gF).scopeTo("JsonEditor"),t=(0,g.hd)(m.w3),i=(0,g.hd)(b),s=(0,g.hd)(m.r_)){this.logger=e,this.element=t,this.apiService=i,this.platform=s,this.fieldSelector=(0,u.zF)(this,n,void 0),this.editor=(0,u.zF)(this,r),this.logger.trace("constructor")}attached(){this.logger.trace("attached"),this.template=this.element.querySelector(".jsonEditor"),this.inputHidden=this.element.querySelector(".jsonInput"),this.inputHidden&&""!==this.inputHidden.value&&this.inputHidden.value&&(this.initialSchema=JSON.parse(this.inputHidden.value)),this.buildEditor()}detached(){this.logger.trace("attached")}buildEditor(){const e={mode:"tree",modes:["tree","text"],search:!1,navigationBar:!1,statusBar:!0,mainMenuBar:!0,enableSort:!1,enableTransform:!1};if(this.template&&(e.onChange=()=>{const e=this.editor.get();this.inputHidden.value=JSON.stringify(e)},this.template)){this.editor=new(A())(this.template,e);let t=this.initialSchema;this.initialSchema||(t={title:{type:"string",title:"Titre"},choix:{type:"radio",title:"Choix",values:[{name:"Externe",value:"extern"},{name:"Interne",value:"interne"}]}}),this.inputHidden.value=JSON.stringify(t),this.editor.set(t)}}},(0,u.yV)(t,"JsonEditor"),(()=>{const l="function"==typeof Symbol&&Symbol.metadata?Object.create(null):void 0;i=[(0,m._t)()],(0,u.G4)(null,null,i,{kind:"field",name:"fieldSelector",static:!1,private:!1,access:{has:e=>"fieldSelector"in e,get:e=>e.fieldSelector,set:(e,t)=>{e.fieldSelector=t}},metadata:l},n,r),(0,u.G4)(null,e={value:t},s,{kind:"class",name:t.name,metadata:l},null,a),t=e.value,l&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:l}),(0,u.zF)(t,a)})(),t})();var F=i(5034),y=i(4676);let S=(()=>{let e,t,i,s,a=[(0,m.U4)("cms-wysiwyg-editor")],n=[],r=[],l=[],o=[],h=[];return t=class{constructor(e=(0,g.hd)(g.gF).scopeTo("WysiwygEditor"),t=(0,g.hd)(m.w3),i=(0,g.hd)(b),s=(0,g.hd)(m.r_)){this.logger=e,this.element=t,this.apiService=i,this.platform=s,this.options=(0,u.zF)(this,r,{theme:"snow",placeholder:"votre texte ici ...",modules:{syntax:{hljs:y.A},toolbar:[[{header:[2,3,4,!1]}],["bold","italic","underline"],["blockquote","code-block"],[{list:"ordered"},{list:"bullet"}],["link","image"],["clean"]]}}),this.inputId=((0,u.zF)(this,l),(0,u.zF)(this,o,void 0)),this.quill=(0,u.zF)(this,h),this.logger.trace("constructor")}attached(){this.logger.trace("attached"),this.inputHidden=this.platform.document.querySelector("#"+this.inputId),this.buildEditor()}detached(){this.logger.trace("attached")}buildEditor(){if(this.quill=new F.Ay(this.element,this.options),this.inputHidden&&this.inputHidden.value){const e=this.blockCodeRestore(this.inputHidden.value);this.quill.root.innerHTML=e}this.quill.on("text-change",()=>{this.logger.trace("text-change",this.quill.root.innerHTML);const e=this.blockCodeClean(this.quill.root.innerHTML);this.inputHidden.value=e})}blockCodeClean(e){this.logger.trace("manageBlockCode");let t=e;if(e){const i=(new DOMParser).parseFromString(e,"text/html"),s=i.querySelector(".ql-code-block-container");if(s){const e=s.querySelectorAll(".ql-code-block");let a=null,n=[];e.forEach((e,t)=>{null==a&&e.hasAttribute("data-language")&&(a=e.getAttribute("data-language")),n.push(e.textContent)});const r=this.platform.document.createElement("pre"),l=this.platform.document.createElement("code");l.classList.add("language-"+a),l.textContent=n.join("\n"),r.append(l),s.replaceWith(r),t=i.body.innerHTML}}return t}blockCodeRestore(e){this.logger.trace("blockCodeRestore");let t=e;if(e){const i=(new DOMParser).parseFromString(e,"text/html"),s=i.querySelector("pre");if(s){const e=s.querySelector("code");if(e){let a=null;e.classList.forEach((e,t)=>{e.startsWith("language-")&&(a=e)});const n=a?a.replace("language-",""):"plain",r=this.platform.document.createElement("div");r.classList.add("ql-code-block-container"),r.setAttribute("spellcheck","false");const l=i.createElement("select");l.classList.add("ql-ui"),l.setAttribute("contenteditable","false");const o=i.createElement("option");o.value=n,o.textContent=n.charAt(0).toUpperCase()+n.slice(1),l.appendChild(o),r.appendChild(l),e.textContent.split("\n").forEach((e,t)=>{const i=this.platform.document.createElement("div");i.classList.add("ql-code-block"),i.setAttribute("data-language",n),i.textContent=e,r.appendChild(i)}),s.replaceWith(r),t=i.body.innerHTML}}}return t}},(0,u.yV)(t,"WysiwygEditor"),(()=>{const d="function"==typeof Symbol&&Symbol.metadata?Object.create(null):void 0;i=[(0,m._t)()],s=[(0,m._t)()],(0,u.G4)(null,null,i,{kind:"field",name:"options",static:!1,private:!1,access:{has:e=>"options"in e,get:e=>e.options,set:(e,t)=>{e.options=t}},metadata:d},r,l),(0,u.G4)(null,null,s,{kind:"field",name:"inputId",static:!1,private:!1,access:{has:e=>"inputId"in e,get:e=>e.inputId,set:(e,t)=>{e.inputId=t}},metadata:d},o,h),(0,u.G4)(null,e={value:t},a,{kind:"class",name:t.name,metadata:d},null,n),t=e.value,d&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:d}),(0,u.zF)(t,n)})(),t})();var k;!function(e){e.ACTION_BUTTON="actionButton",e.ACTION_FILE_END="fileEnd",e.ACTION_ADD_ALERT="addAlert",e.ACTION_DELETE_ALERT="alertDelete",e.ACTION_MOVE_MENU_ITEM_BEFORE="moveMenuItemBefore",e.ACTION_MOVE_MENU_ITEM_AFTER="moveMenuItemAfter"}(k||(k={}));const w={upItem:"Un item a été remonter",downItem:"Un item a été descendu",deleteItem:"Un item a été supprimé"};let L=(()=>{let e,t,i,s,a=[(0,m.U4)("fractalcms-item")],n=[],r=[],l=[],o=[],h=[];return t=class{constructor(e=(0,g.hd)(g.gF).scopeTo("Item"),t=(0,g.hd)(m.w3),i=(0,g.hd)(g.xe),s=(0,g.hd)(b),a=(0,g.hd)(m.r_)){this.logger=e,this.element=t,this.ea=i,this.apiService=s,this.platform=a,this.id=(0,u.zF)(this,r,void 0),this.targetId=((0,u.zF)(this,l),(0,u.zF)(this,o,void 0)),this.actionButtons=(0,u.zF)(this,h),this.onAction=e=>{this.logger.trace("onAction");let t=e.target;if(t&&("button"!==t.nodeName&&(t=t.closest("button")),t)){e.preventDefault();const s=t.getAttribute("name"),a={action:s,value:t.getAttribute("value")},n={id:window.crypto.randomUUID(),message:(i=s,i&&(i=w.hasOwnProperty(i)?w[i]:w(i)),i),color:"alert-warning"};this.platform.taskQueue.queueTask(()=>{this.ea.publish(k.ACTION_BUTTON,a),this.ea.publish(k.ACTION_ADD_ALERT,n)})}var i},this.logger.trace("constructor")}attached(){this.logger.trace("attached"),this.addEvent()}detached(){this.logger.trace("attached"),this.removeEvent()}addEvent(){this.logger.trace("addEvent"),this.actionButtons=this.element.querySelectorAll(".actionButtons"),this.actionButtons.forEach((e,t)=>{e.addEventListener("click",this.onAction)})}removeEvent(){this.logger.trace("removeEvent"),this.actionButtons.forEach((e,t)=>{e.removeEventListener("click",this.onAction)})}},(0,u.yV)(t,"Item"),(()=>{const d="function"==typeof Symbol&&Symbol.metadata?Object.create(null):void 0;i=[(0,m._t)()],s=[(0,m._t)()],(0,u.G4)(null,null,i,{kind:"field",name:"id",static:!1,private:!1,access:{has:e=>"id"in e,get:e=>e.id,set:(e,t)=>{e.id=t}},metadata:d},r,l),(0,u.G4)(null,null,s,{kind:"field",name:"targetId",static:!1,private:!1,access:{has:e=>"targetId"in e,get:e=>e.targetId,set:(e,t)=>{e.targetId=t}},metadata:d},o,h),(0,u.G4)(null,e={value:t},a,{kind:"class",name:t.name,metadata:d},null,n),t=e.value,d&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:d}),(0,u.zF)(t,n)})(),t})(),T=(()=>{let e,t,i=[(0,m.U4)("cms-menu")],s=[];return t=class{constructor(e=(0,g.hd)(g.gF).scopeTo("Menu"),t=(0,g.hd)(m.w3),i=(0,g.hd)(g.xe),s=(0,g.hd)(b),a=(0,g.hd)(m.r_)){this.logger=e,this.element=t,this.ea=i,this.apiService=s,this.platform=a,this.onAction=e=>{this.logger.trace("onAction");let t=e.target;if(t){const e=t.getAttribute("aria-controls");if(e){this.closeOthers(e);const i=this.element.querySelector("#"+e);i&&(i.classList.contains("show")?(i.classList.remove("show"),i.setAttribute("aria-expanded","false"),t.setAttribute("aria-expanded","false")):(i.classList.add("show"),i.setAttribute("aria-expanded","true"),t.setAttribute("aria-expanded","true")))}}},this.logger.trace("constructor")}attached(){this.logger.trace("attached"),this.addEvent()}detached(){this.logger.trace("attached"),this.removeEvent()}addEvent(){this.logger.trace("addEvent"),this.actionButtons=this.element.querySelectorAll('[data-toggle="dropdown"]'),this.actionButtons.forEach((e,t)=>{e.addEventListener("click",this.onAction)})}removeEvent(){this.logger.trace("removeEvent"),this.actionButtons.forEach((e,t)=>{e.removeEventListener("click",this.onAction)})}closeOthers(e){this.logger.trace("closeOthers"),this.element.querySelectorAll(".dropdown-menu").forEach((t,i)=>{t.id!=e&&t.classList.remove("show")})}},(0,u.yV)(t,"Menu"),(()=>{const a="function"==typeof Symbol&&Symbol.metadata?Object.create(null):void 0;(0,u.G4)(null,e={value:t},i,{kind:"class",name:t.name,metadata:a},null,s),t=e.value,a&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:a}),(0,u.zF)(t,s)})(),t})();var D;!function(e){e.attached="menu-item:attached",e.detached="menu-item:detached"}(D||(D={}));let _=(()=>{let e,t,i=[(0,m.U4)("cms-menu-item-list")],s=[];return t=class{constructor(e=(0,g.hd)(g.gF).scopeTo("MenuItemList"),t=(0,g.hd)(m.w3),i=(0,g.hd)(g.xe),s=(0,g.hd)(b),a=(0,g.hd)(m.r_)){this.logger=e,this.element=t,this.ea=i,this.apiService=s,this.platform=a,this.onDelete=e=>{this.logger.trace("onDelete"),e.preventDefault();const t=e.currentTarget;if(t&&!0===confirm("Attention !! vous allez supprimer définitivement cet élément ? ")){const e=t.href;this.apiService.delete(e).then(e=>{this.platform.taskQueue.queueTask(()=>{this.platform.window.location.reload()})}).catch(e=>{this.logger.trace("Delete  ERROR",e)})}},this.ondragstart=e=>{this.logger.trace("ondragstart");const t=e.target;t.classList.add("dragging"),this.dragItem=t},this.dragend=e=>{this.logger.trace("dragend");const t=e.target;this.dragItem==t&&(t.classList.remove("over"),t.classList.remove("dragging"))},this.dragover=e=>{this.logger.trace("dragover"),e.preventDefault();const t=e.target.closest("li");t&&t.classList.add("over")},this.dragleave=e=>{this.logger.trace("dragleave"),e.target.classList.remove("over")},this.drop=e=>{this.logger.trace("drop",e),e.stopPropagation();const t=e.target.closest("li");if(t&&this.dragItem&&this.dragItem!==t){const e=this.buildMenuItemData(t,this.dragItem);this.apiService.manageMenuItems(parseInt(t.getAttribute("data-menu-id")),e).then(i=>{const s={name:"menu-item-list",action:D.detached};this.ea.publish(k.ACTION_MOVE_MENU_ITEM_BEFORE,s),this.dragItem.classList.remove("over"),this.dragItem.classList.remove("dragging"),t.classList.remove("over"),t.classList.remove("dragging"),t.parentNode.insertBefore(this.dragItem,t),this.platform.taskQueue.queueTask(()=>{this.detached(),this.element.innerHTML=i,this.attached(),this.platform.requestAnimationFrame(()=>{const t={name:"menu-item-list",action:D.attached};this.ea.publish(k.ACTION_MOVE_MENU_ITEM_AFTER,t),this.logger.trace("drop Item déplacé !!!",e)})},{delay:150})}).catch(e=>{this.logger.warn(e),this.logger.trace("drop Item ERROR !!!",e)})}},this.logger.trace("constructor")}attached(){this.logger.trace("attached"),this.items=this.element.querySelectorAll("li"),this.deleteLinks=this.element.querySelectorAll(".user-button-delete"),this.init()}detached(){this.logger.trace("detached"),this.items&&this.items.forEach((e,t)=>{e.removeEventListener("dragstart",this.ondragstart),e.removeEventListener("dragend",this.dragend),e.removeEventListener("dragover",this.dragover),e.removeEventListener("dragleave",this.dragleave),e.removeEventListener("drop",this.drop)}),this.deleteLinks&&this.deleteLinks.forEach((e,t)=>{e.removeEventListener("click",this.onDelete)})}init(){this.logger.trace("init"),this.items.forEach((e,t)=>{e.addEventListener("dragstart",this.ondragstart),e.addEventListener("dragend",this.dragend),e.addEventListener("dragover",this.dragover),e.addEventListener("dragleave",this.dragleave),e.addEventListener("drop",this.drop)}),this.deleteLinks&&this.deleteLinks.forEach((e,t)=>{e.addEventListener("click",this.onDelete)})}buildMenuItemData(e,t){return this.logger.trace("buildMenuItemData"),{sourceMenuItemId:parseInt(t.getAttribute("data-id")),destMenuItemId:parseInt(e.getAttribute("data-id"))}}},(0,u.yV)(t,"MenuItemList"),(()=>{const a="function"==typeof Symbol&&Symbol.metadata?Object.create(null):void 0;(0,u.G4)(null,e={value:t},i,{kind:"class",name:t.name,metadata:a},null,s),t=e.value,a&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:a}),(0,u.zF)(t,s)})(),t})(),x=(()=>{let e,t,i,s,a,n=[(0,m.U4)("fractalcms-select-beautiful")],r=[],l=[],o=[],h=[],d=[],c=[],p=[];return t=class{constructor(e=(0,g.hd)(g.gF).scopeTo("SelectBeautiful"),t=(0,g.hd)(m.w3),i=(0,g.hd)(g.xe),s=(0,g.hd)(b),a=(0,g.hd)(m.r_)){this.logger=e,this.element=t,this.ea=i,this.apiService=s,this.platform=a,this.multiple=(0,u.zF)(this,l,!0),this.inputName=((0,u.zF)(this,o),(0,u.zF)(this,h,void 0)),this.searchInputName=((0,u.zF)(this,d),(0,u.zF)(this,c,"model[search]")),this.listElement=(0,u.zF)(this,p),this.currentChoiced=[],this.listOpen=!1,this.activeItemNewIndex=-1,this.availableKeyboard=["ArrowDown","ArrowUp","Enter","Escape"],this.onSearch=e=>{this.logger.trace("onSearch"),e.preventDefault(),this.openList();const t=e.currentTarget.value.trim().toLowerCase();this.optionsFiltered=this.options.filter((e,i)=>{if(e.textContent.includes(t))return e}),this.buildList(this.optionsFiltered)},this.onFocus=e=>{this.logger.trace("onFocus"),e.preventDefault(),this.openList()},this.onFocusout=e=>{this.logger.trace("onFocusout"),e.preventDefault(),this.closeList()},this.onKeydown=e=>{this.logger.trace("onKeydown",e);const t=e.key;if(this.availableKeyboard.includes(t)){e.preventDefault();const i=this.listElement.children.length;switch(this.listOpen||this.openList(),this.activeItemPrevIndex=this.activeItemNewIndex,t){case"ArrowDown":this.activeItemNewIndex>=i-1&&(this.activeItemNewIndex=-1),this.activeItemNewIndex=Math.min(this.activeItemNewIndex+1,i-1),this.logger.trace("ArrowDown",this.activeItemNewIndex,i,this.activeItemPrevIndex);break;case"ArrowUp":0==this.activeItemNewIndex&&(this.activeItemNewIndex=i),this.activeItemNewIndex=Math.max(this.activeItemNewIndex-1,0),this.logger.trace("ArrowUp",this.activeItemNewIndex,i,this.activeItemPrevIndex);break;case"Enter":{this.logger.trace("Enter",this.activeItemNewIndex,i,this.activeItemPrevIndex);const e=this.findListItem(this.activeItemNewIndex);this.manageItem(e);break}case"Escape":this.activeItemNewIndex=-1,this.closeList(),this.inputSearch.focus()}this.ariaActiveItem(this.activeItemNewIndex,!0),this.ariaActiveItem(this.activeItemPrevIndex,!1)}},this.onItemClick=e=>{this.logger.trace("onItemClick"),e.preventDefault();const t=e.currentTarget;this.manageItem(t),this.closeList()},this.onRemoveItem=e=>{this.logger.trace("removeItem"),e.preventDefault();const t=e.currentTarget.closest("span.item");t&&(this.unSelected(t),this.notification(t.firstChild.textContent+" retiré"),t.remove())},this.logger.trace("constructor"),this.options=[]}attached(){this.logger.trace("attached"),this.multiple&&this.init()}detached(){this.logger.trace("attached"),this.inputSearch&&(null==this||this.inputSearch.removeEventListener("input",this.onSearch))}init(){this.logger.trace("init"),this.multiple&&this.element.setAttribute("multiple","true");const e=this.element.getAttribute("prompt");this.element.style.display="none",this.element.querySelectorAll("option").forEach((e,t)=>{if(e.value&&(this.options.push(e),e.selected)){e.setAttribute("aria-selected","true");const t={value:e.value,content:e.textContent};this.currentChoiced.push(t)}}),this.listElement=this.platform.document.createElement("ul"),this.closeList(),this.listElement.setAttribute("role","listbox"),this.listElement.setAttribute("aria-label",e),this.listElement.setAttribute("aria-multiselectable","true"),this.listElement.setAttribute("tabindex","0"),this.listElement.classList.add("list-items-container"),this.buildList(this.options),this.divContainer=this.platform.document.createElement("div"),this.divContainer.classList.add("select-beautiful-container"),this.inputSearch=this.platform.document.createElement("input"),this.inputSearch.type="text",this.inputSearch.classList.add("input-search"),this.inputSearch.name=this.searchInputName,this.inputSearch.setAttribute("autocomplete","off"),this.inputSearch.placeholder="Rechercher",this.inputSearch.setAttribute("aria-label","Rechercher"),this.inputSearch.addEventListener("input",this.onSearch),this.inputSearch.addEventListener("focusin",this.onFocus),this.inputSearch.addEventListener("focusout",this.onFocusout),this.inputSearch.addEventListener("keydown",this.onKeydown),this.divItemContainer=this.platform.document.createElement("div"),this.divItemContainer.classList.add("item-container"),this.divItemContainer.append(this.inputSearch),this.divSearchContainer=this.platform.document.createElement("div"),this.divSearchContainer.classList.add("search-container"),this.divSearchContainer.append(this.listElement),this.divLiveMsg=this.platform.document.createElement("div"),this.divLiveMsg.setAttribute("aria-live","polite"),this.divLiveMsg.classList.add("sr-only"),this.element.before(this.divItemContainer),this.element.before(this.divSearchContainer),this.element.before(this.divLiveMsg),this.listElement.querySelectorAll("li").forEach((e,t)=>{"true"==e.getAttribute("aria-selected")&&this.addItem(e)})}buildList(e){this.logger.trace("buildList"),this.listElement.innerHTML="",e.forEach((e,t)=>{this.addItemList(e,t)})}addItemList(e,t){this.logger.trace("addItemList",t);const i=this.platform.document.createElement("li");i.classList.add("list-option"),i.setAttribute("role","option"),i.setAttribute("id","option-"+t),i.setAttribute("data-id",e.value),i.setAttribute("data-index",t.toString()),this.findChoiceItem(e.value)?i.setAttribute("aria-selected","true"):i.setAttribute("aria-selected","false"),i.textContent=e.textContent,i.addEventListener("click",this.onItemClick),this.listElement.append(i)}ariaActiveItem(e,t){this.logger.trace("activeItem");const i="option-"+e;this.listElement.setAttribute("aria-activedescendant",i);const s=this.findListItem(e);s&&(t?s.classList.add("active"):s.classList.remove("active"))}notification(e){this.platform.setTimeout(()=>{this.divLiveMsg.textContent=e},50)}addItem(e){this.logger.trace("addItem");const t=this.platform.document.createElement("span");e.setAttribute("aria-selected","true"),t.setAttribute("data-id",e.getAttribute("data-id")),t.classList.add("item"),t.textContent=e.textContent;const i=this.platform.document.createElement("button");i.classList.add("item-close"),i.role="button",i.textContent="X",i.addEventListener("click",this.onRemoveItem),t.append(i);const s={value:e.getAttribute("data-id"),content:e.textContent};this.notification(e.textContent+" ajouté"),this.pushChoiceItem(s),this.inputSearch.before(t)}pushChoiceItem(e){this.logger.trace("pushChoiceItem"),this.findChoiceItem(e.value)||this.currentChoiced.push(e)}removeChoiceItem(e){if(this.logger.trace("removeChoiceItem"),this.currentChoiced.length>0){const t=[];this.currentChoiced.forEach((i,s)=>{i.value!=e&&t.push(i)}),this.currentChoiced=[...t]}}findChoiceItem(e){return this.logger.trace("findChoiceItem"),this.currentChoiced.find((t,i)=>e==t.value)}findListItem(e){let t;return this.logger.trace("findChoiceItem"),this.listElement&&(t=this.listElement.children.item(e)),t}removeItem(e){this.logger.trace("removeItem");const t=e.getAttribute("data-id");this.divItemContainer.querySelectorAll("span").forEach((i,s)=>{const a=i.getAttribute("data-id");a==t&&(this.removeChoiceItem(a),i.remove(),this.notification(e.textContent+" retiré"))})}manageItem(e){this.logger.trace("manageItem"),e&&("false"==e.getAttribute("aria-selected")?this.addItem(e):(e.setAttribute("aria-selected","false"),this.removeItem(e)),this.updateInputSelectElement())}closeList(){this.listElement.style.display="none",this.inputSearch&&(this.inputSearch.classList.add("input-search"),this.inputSearch.classList.remove("input-search--focus")),this.listOpen=!1}openList(){this.listElement.style.display="block",this.inputSearch&&(this.inputSearch.classList.remove("input-search"),this.inputSearch.classList.add("input-search--focus")),this.listOpen=!0}unSelected(e){this.logger.trace("unSelected");const t=e.getAttribute("data-id");this.listElement.querySelectorAll("li").forEach((e,i)=>{const s=e.getAttribute("data-id");t==s&&(this.removeChoiceItem(s),e.setAttribute("aria-selected","false"))})}updateInputSelectElement(){this.logger.trace("updateInputSelectElement"),this.options.forEach((e,t)=>{e.removeAttribute("selected"),this.currentChoiced.forEach((t,i)=>{e.value==t.value&&e.setAttribute("selected","")})})}},(0,u.yV)(t,"SelectBeautiful"),(()=>{const g="function"==typeof Symbol&&Symbol.metadata?Object.create(null):void 0;i=[(0,m._t)()],s=[(0,m._t)()],a=[(0,m._t)()],(0,u.G4)(null,null,i,{kind:"field",name:"multiple",static:!1,private:!1,access:{has:e=>"multiple"in e,get:e=>e.multiple,set:(e,t)=>{e.multiple=t}},metadata:g},l,o),(0,u.G4)(null,null,s,{kind:"field",name:"inputName",static:!1,private:!1,access:{has:e=>"inputName"in e,get:e=>e.inputName,set:(e,t)=>{e.inputName=t}},metadata:g},h,d),(0,u.G4)(null,null,a,{kind:"field",name:"searchInputName",static:!1,private:!1,access:{has:e=>"searchInputName"in e,get:e=>e.searchInputName,set:(e,t)=>{e.searchInputName=t}},metadata:g},c,p),(0,u.G4)(null,e={value:t},n,{kind:"class",name:t.name,metadata:g},null,r),t=e.value,g&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:g}),(0,u.zF)(t,r)})(),t})();const O="alert",U='<template>\n    <div class="alert p-2 row align-items-center mb-2" class.bind="color" role="alert"\n         aria-label="notification de modification" id.bind="id">\n        <div class="col-sm-11">${message}</div>\n        <div class="col-sm-1 m-0 text-center">\n            <button class="btn btn-close" type="button" click.trigger="onClose($event)"></button>\n        </div>\n    </div>\n</template>',M=U,N=[],z={};let P;function R(e){P||(P=m.K9.define({name:O,template:U,dependencies:N,bindables:z})),e.register(P)}i(4066);let j=(()=>{let e,t,i,s,n,r=[(0,m.EM)(Object.assign(Object.assign({},a),{name:"cms-alert"}))],l=[],o=[],h=[],d=[],c=[],p=[],v=[];return t=class{constructor(e=(0,g.hd)(g.gF),t=(0,g.hd)(g.xe),i=(0,g.hd)(m.r_),s=(0,g.hd)(m.w3)){this.logger=e,this.ea=t,this.platform=i,this.element=s,this.id=(0,u.zF)(this,o,void 0),this.message=((0,u.zF)(this,h),(0,u.zF)(this,d,void 0)),this.color=((0,u.zF)(this,c),(0,u.zF)(this,p,void 0)),(0,u.zF)(this,v),this.logger=e,this.ea=t,this.platform=i,this.element=s,this.logger=e.scopeTo("Alert"),this.logger.trace("constructor")}binding(){this.logger.trace("binding")}attached(){this.logger.trace("attached",this.id),this.platform.setTimeout(()=>{this.close()},1500)}onClose(e){this.logger.trace("onClose"),e.preventDefault(),this.close()}close(){if(this.element){const e=this.element.querySelector("div.alert");e&&(e.remove(),this.ea.publish(k.ACTION_DELETE_ALERT,{id:this.id}))}}},(0,u.yV)(t,"Alert"),(()=>{const a="function"==typeof Symbol&&Symbol.metadata?Object.create(null):void 0;i=[m._t],s=[m._t],n=[m._t],(0,u.G4)(null,null,i,{kind:"field",name:"id",static:!1,private:!1,access:{has:e=>"id"in e,get:e=>e.id,set:(e,t)=>{e.id=t}},metadata:a},o,h),(0,u.G4)(null,null,s,{kind:"field",name:"message",static:!1,private:!1,access:{has:e=>"message"in e,get:e=>e.message,set:(e,t)=>{e.message=t}},metadata:a},d,c),(0,u.G4)(null,null,n,{kind:"field",name:"color",static:!1,private:!1,access:{has:e=>"color"in e,get:e=>e.color,set:(e,t)=>{e.color=t}},metadata:a},p,v),(0,u.G4)(null,e={value:t},r,{kind:"class",name:t.name,metadata:a},null,l),t=e.value,a&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:a}),(0,u.zF)(t,l)})(),t})();const q="content-manage-items",B='<template>\n    <au-compose template.bind="view"></au-compose>\n</template>',G=B,H=[],V={};let W;function $(e){W||(W=m.K9.define({name:q,template:B,dependencies:H,bindables:V})),e.register(W)}var J;!function(e){e.UP_ITEM="upItem",e.DOWN_ITEM="downItem",e.DELETE_ITEM="deleteItem",e.ADD_ITEM="addItem"}(J||(J={}));let K=(()=>{let e,t,i,s,a,r=[(0,m.EM)(Object.assign(Object.assign({},n),{name:"fractalcms-content-manage-items"}))],l=[],o=[],h=[],d=[],c=[],p=[],v=[];return t=class{constructor(e=(0,g.hd)(g.gF),t=(0,g.hd)(g.xe),i=(0,g.hd)(b),s=(0,g.hd)(m.w3)){this.logger=e,this.ea=t,this.apiServices=i,this.element=s,this.id=(0,u.zF)(this,o,void 0),this.view=((0,u.zF)(this,h),(0,u.zF)(this,d,void 0)),this.itemApiUrl=((0,u.zF)(this,c),(0,u.zF)(this,p,void 0)),this.form=(0,u.zF)(this,v),this.onAdd=e=>{this.logger.trace("onAdd");const t=e.target;if(t){const i=t.closest("button");i&&(e.preventDefault(),this.sendAction(i.name,i.value))}},this.onAction=e=>{this.logger.trace("onAction"),this.sendAction(e.action,e.value)},this.logger=e.scopeTo("ContentManage"),this.logger.trace("constructor")}binding(){this.logger.trace("binding")}attached(){this.logger.trace("attached",this.id),this.form=this.element.closest("form"),this.prepare()}bound(){this.logger.trace("bound"),this.eaActionDispose=this.ea.subscribe(k.ACTION_BUTTON,this.onAction)}unbinding(){this.logger.trace("unbinding"),this.eaActionDispose.dispose(),this.buttonAdd&&this.buttonAdd.removeEventListener("click",this.onAdd)}prepare(){this.buttonAdd=this.element.querySelector('button[name="addItem"]'),this.logger.trace("attached",this.id),this.buttonAdd&&this.buttonAdd.addEventListener("click",this.onAdd)}sendAction(e,t){if(this.logger.trace("sendAction"),this.form){const i=new FormData(this.form);i.append(e,t);const s=this.itemApiUrl.replace("{targetId}",this.id.toString());this.apiServices.manageItems(s,i).then(t=>{if(e!==J.ADD_ITEM){const e={id:window.crypto.randomUUID(),message:"Un item a été ajouté",color:"alert-success"};this.ea.publish(k.ACTION_ADD_ALERT,e)}this.view=t,this.prepare()}).catch(e=>{this.logger.error(e.text());const t={id:window.crypto.randomUUID(),message:"Un erreur c'est produite",color:"alert-danger"};this.ea.publish(k.ACTION_ADD_ALERT,t)})}}},(0,u.yV)(t,"ContentManageItems"),(()=>{const n="function"==typeof Symbol&&Symbol.metadata?Object.create(null):void 0;i=[m._t],s=[m._t],a=[m._t],(0,u.G4)(null,null,i,{kind:"field",name:"id",static:!1,private:!1,access:{has:e=>"id"in e,get:e=>e.id,set:(e,t)=>{e.id=t}},metadata:n},o,h),(0,u.G4)(null,null,s,{kind:"field",name:"view",static:!1,private:!1,access:{has:e=>"view"in e,get:e=>e.view,set:(e,t)=>{e.view=t}},metadata:n},d,c),(0,u.G4)(null,null,a,{kind:"field",name:"itemApiUrl",static:!1,private:!1,access:{has:e=>"itemApiUrl"in e,get:e=>e.itemApiUrl,set:(e,t)=>{e.itemApiUrl=t}},metadata:n},p,v),(0,u.G4)(null,e={value:t},r,{kind:"class",name:t.name,metadata:n},null,l),t=e.value,n&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:n}),(0,u.zF)(t,l)})(),t})();const Q="manage-alerts",Y='<template>\n    <div class="row sticky-top" repeat.for="alert of alerts">\n        <cms-alert repeat.for="alert of alerts" id.bind="alert.id" message.bind="alert.message" color.bind="alert.color"></cms-alert>\n    </div>\n</template>',X=Y,Z=[],ee={};let te;function ie(e){te||(te=m.K9.define({name:Q,template:Y,dependencies:Z,bindables:ee})),e.register(te)}let se=(()=>{let e,t,i=[(0,m.EM)(Object.assign(Object.assign({},r),{name:"cms-manage-alerts"}))],s=[];return t=class{constructor(e=(0,g.hd)(g.gF),t=(0,g.hd)(g.xe),i=(0,g.hd)(b),s=(0,g.hd)(m.w3)){this.logger=e,this.ea=t,this.apiServices=i,this.element=s,this.alerts=[],this.onAdd=e=>{this.logger.trace("onAdd"),this.alerts.push({id:e.id,message:e.message,color:e.color})},this.onDelete=e=>{this.logger.trace("onDelete");let t=null;this.alerts.forEach((i,s)=>{i.id==e.id&&(t=s)}),null!==t&&this.alerts.splice(t,1)},this.logger=e.scopeTo("ManageAlerts"),this.logger.trace("constructor")}binding(){this.logger.trace("binding")}attached(){this.logger.trace("attached")}bound(){this.logger.trace("bound"),this.eaAddDispose=this.ea.subscribe(k.ACTION_ADD_ALERT,this.onAdd),this.eaDeleteDispose=this.ea.subscribe(k.ACTION_DELETE_ALERT,this.onDelete)}unbinding(){this.logger.trace("unbinding"),this.eaAddDispose.dispose(),this.eaDeleteDispose.dispose()}},(0,u.yV)(t,"ManageAlerts"),(()=>{const a="function"==typeof Symbol&&Symbol.metadata?Object.create(null):void 0;(0,u.G4)(null,e={value:t},i,{kind:"class",name:t.name,metadata:a},null,s),t=e.value,a&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:a}),(0,u.zF)(t,s)})(),t})();const ae="file",ne='<template>\n    <div class="row">\n        <div class="col">\n            <div class="card">\n                <div class="card-header">\n                    ${title}\n                </div>\n                <div class="card-body">\n                    <div class="row">\n                        <div class="col-sm-3" ref="drop">\n                            <div class="p-1 border border-1 border-gray-500">\n                                <svg width="96px" ref="icon" stroke="currentColor" fill="none" viewBox="0 0 48 48" aria-hidden="true">\n                                    <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>\n                                </svg>\n                                <div class="element-form-bloc-upload-drop-input-wrapper" ref="browse">\n                                    <span>${uploadFileText}</span>\n                                    <p class="element-form-bloc-upload-drop-input-accessory">${uploadFileDnd}</p>\n                                </div>\n                                <p class="element-form-bloc-abstract">\n                                    ${fileInfo}\n                                </p>\n                            </div>\n                            <p class="element-form-bloc-abstract">${uploadFileDescription}</p>\n                        </div>\n                    </div>\n                    <div class="row">\n                        <div class="col-sm-2 m-0">\n                            <span class="loader" if.bind="inProgress">\n                                  <svg xmlns="http://www.w3.org/2000/svg" width="60" height="40" viewBox="0 0 100 100" fill="#0d6efd">\n                                    <rect x="15" y="40" width="10" height="20">\n                                        <animate attributeName="height" values="20;60;20" begin="0s" dur="0.6s" repeatCount="indefinite"/>\n                                        <animate attributeName="y" values="40;20;40" begin="0s" dur="0.6s" repeatCount="indefinite"/>\n                                    </rect>\n                                    <rect x="35" y="40" width="10" height="20">\n                                        <animate attributeName="height" values="20;60;20" begin="0.2s" dur="0.6s" repeatCount="indefinite"/>\n                                        <animate attributeName="y" values="40;20;40" begin="0.2s" dur="0.6s" repeatCount="indefinite"/>\n                                    </rect>\n                                    <rect x="55" y="40" width="10" height="20">\n                                        <animate attributeName="height" values="20;60;20" begin="0.4s" dur="0.6s" repeatCount="indefinite"/>\n                                        <animate attributeName="y" values="40;20;40" begin="0.4s" dur="0.6s" repeatCount="indefinite"/>\n                                    </rect>\n                                </svg>\n                            </span>\n                            <div class="card" repeat.for="handledFile of handledFiles">\n                                <div class="card-header">\n                                    <div class="row align-items-center">\n                                        <div  class="col-sm-8 fs-6 text-truncate">\n                                            ${handledFile.shortname}\n                                        </div>\n                                        <div class="col-sm-4 justify-content-end">\n                                            <button type="button" click.trigger="onRemove(handledFile, $event)" class="btn btn-danger p-0" style="top: 20px;">\n                                                <svg width="24px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n                                                    <path d="M4 6H20M16 6L15.7294 5.18807C15.4671 4.40125 15.3359 4.00784 15.0927 3.71698C14.8779 3.46013 14.6021 3.26132 14.2905 3.13878C13.9376 3 13.523 3 12.6936 3H11.3064C10.477 3 10.0624 3 9.70951 3.13878C9.39792 3.26132 9.12208 3.46013 8.90729 3.71698C8.66405 4.00784 8.53292 4.40125 8.27064 5.18807L8 6M18 6V16.2C18 17.8802 18 18.7202 17.673 19.362C17.3854 19.9265 16.9265 20.3854 16.362 20.673C15.7202 21 14.8802 21 13.2 21H10.8C9.11984 21 8.27976 21 7.63803 20.673C7.07354 20.3854 6.6146 19.9265 6.32698 19.362C6 18.7202 6 17.8802 6 16.2V6M14 10V17M10 10V17" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n                                                </svg>\n                                            </button>\n                                        </div>\n                                    </div>\n                                </div>\n                                <div class="card-body">\n                                    <a target="_blank" href.bind="handledFile.previewUrl + \'&original=1\'" class="cursor-pointer">\n                                        <img class="img-thumbnail" width="100px" alt.bind="handledFile.shortname" src.bind="handledFile.previewUrl" title.bind="handledFile.shortname"/>\n                                    </a>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n</template>\n',re=ne,le=[],oe={};let he;function de(e){he||(he=m.K9.define({name:ae,template:ne,dependencies:le,bindables:oe})),e.register(he)}var ce=i(832),ue=i.n(ce),me=i(5449),ge=i.n(me);let pe=(()=>{let e,t,i,s,a,n,r,o,d,c,p,f,E,I=[(0,m.EM)(Object.assign(Object.assign({},l),{name:"cms-file-upload"}))],A=[],C=[],F=[],y=[],S=[],w=[],L=[],T=[],D=[],_=[],x=[],O=[],U=[],M=[],N=[],z=[],P=[],R=[],j=[],q=[],B=[],G=[],H=[];return t=class{constructor(e=(0,g.hd)(g.gF),t=(0,g.hd)(m.r_),i=(0,g.hd)(m.w3),s=(0,g.hd)(b),a=(0,g.hd)(v),n=(0,g.hd)(g.xe)){this.logger=e,this.platform=t,this.element=i,this.apiServices=s,this.configService=a,this.ea=n,this.inProgress=!1,this.previewUrl=h.IMPORT_ASYNC_PREVIEW,this.deleteUrl=h.IMPORT_ASYNC_DELETE,this.fileType=(0,u.zF)(this,C,"xls,xlsx,csv,zip,TXT,txt, png,jpeg,jpg,gif,webp"),this.name=((0,u.zF)(this,F),(0,u.zF)(this,y,void 0)),this.multiple=((0,u.zF)(this,S),(0,u.zF)(this,w,!1)),this.value=((0,u.zF)(this,L),(0,u.zF)(this,T,"")),this.imageWidth=((0,u.zF)(this,D),(0,u.zF)(this,_,void 0)),this.imageHeight=((0,u.zF)(this,x),(0,u.zF)(this,O,void 0)),this.title=((0,u.zF)(this,U),(0,u.zF)(this,M,void 0)),this.uploadFileText=((0,u.zF)(this,N),(0,u.zF)(this,z,"Télécharger un fichier")),this.uploadFileDnd=((0,u.zF)(this,P),(0,u.zF)(this,R,void 0)),this.uploadFileDescription=((0,u.zF)(this,j),(0,u.zF)(this,q,void 0)),this.error=((0,u.zF)(this,B),(0,u.zF)(this,G,!1)),this.onFileEnd=((0,u.zF)(this,H),()=>{this.logger.trace("onFileEnd"),this.resumable.support&&(this.drop.removeEventListener("dragover",this.onDragEnter),this.drop.removeEventListener("dragenter",this.onDragEnter),this.drop.removeEventListener("dragleave",this.onDragLeave),this.drop.removeEventListener("drop",this.onDragLeave)),this.setUp()}),this.onDragEnter=e=>{e.preventDefault();let t=e.currentTarget,i=e.dataTransfer;i&&i.types.indexOf("Files")>=0?(e.stopPropagation(),i.dropEffect="copy",i.effectAllowed="copy",t.classList.add("border-green-700")):i&&(i.dropEffect="none",i.effectAllowed="none")},this.onDragLeave=e=>{e.currentTarget.classList.remove("border-green-700")},this.onFileAdded=(e,t)=>{this.logger.debug("onFileAdded",e,t),this.inProgress=!0,this.resumable.upload()},this.onFileSuccess=(e,t)=>{const i=JSON.parse(t),s=i.hasOwnProperty("finalFilename")?i.finalFilename:null;this.inProgress=!1,!1===this.multiple?this.setFile("@webapp/runtime/uploads/"+s,e):this.appendFile("@webapp/runtime/uploads/"+s,e),this.platform.taskQueue.queueTask(()=>{const e={id:window.crypto.randomUUID(),message:"Le fichier a été ajouté",color:"alert-success"};this.ea.publish(k.ACTION_ADD_ALERT,e)},{delay:150}),this.logger.debug("onFileSuccess",e,e)},this.onFileProgress=(e,t)=>{this.logger.debug("onFileProgress",e,t)},this.onFilesAdded=(e,t)=>{this.logger.debug("onFilesAdded",e,t),this.inProgress=!1},this.onFileRetry=e=>{this.logger.debug("onFileRetry",e)},this.onFileError=(e,t)=>{this.logger.debug("onFileError",e,t),this.inProgress=!1},this.onUploadStart=()=>{this.logger.debug("onUploadStart"),this.inProgress=!0},this.onComplete=()=>{this.logger.debug("onComplete"),this.inProgress=!1},this.onProgress=()=>{this.logger.debug("onProgress"),this.inProgress=!0},this.onError=(e,t)=>{this.logger.debug("onError",t,e)},this.onPause=()=>{this.logger.debug("onPause")},this.onBeforeCancel=()=>{this.logger.debug("onBeforeCancel")},this.onCancel=()=>{this.logger.debug("onCancel"),this.inProgress=!1},this.onChunkingStart=e=>{this.logger.debug("onChunkingStart",e)},this.onChunkingProgress=(e,t)=>{this.logger.debug("onChunkingProgressd",e,t)},this.onChunkingComplete=e=>{this.logger.debug("onChunkingComplete",e)},this.logger=e.scopeTo("File"),this.logger.trace("constructor")}attached(){this.logger.trace("attached"),this.subscriptionFileEnd=this.ea.subscribe(k.ACTION_FILE_END,this.onFileEnd),this.setUp()}dispose(){this.logger.trace("dispose"),this.subscriptionFileEnd.dispose()}detached(){this.logger.trace("detaching"),this.resumable.support&&(this.drop.removeEventListener("dragover",this.onDragEnter),this.drop.removeEventListener("dragenter",this.onDragEnter),this.drop.removeEventListener("dragleave",this.onDragLeave),this.drop.removeEventListener("drop",this.onDragLeave))}onRemove(e,t){t.stopPropagation(),t.preventDefault(),this.logger.debug("Should remove file",e,t);let i=null;this.handledFiles.forEach((t,s)=>{e.name===t.name&&(i=s)}),null!==i&&i>=0&&(e.file&&null!==e.file&&this.resumable.removeFile(e.file),this.handledFiles.splice(i,1),this.apiServices.delete(e.deleteUrl),this.platform.taskQueue.queueTask(()=>{const e={id:window.crypto.randomUUID(),message:"Le fichier a été supprimé",color:"alert-warning"};this.ea.publish(k.ACTION_ADD_ALERT,e)},{delay:150}));let s=this.getFilesValue();this.hiddenField.value=s}appendFile(e,t=null){this.handledFiles.push({name:e,shortname:e.split(/.*[\/|\\]/).pop(),previewUrl:this.generatePreviewUrl(e),deleteUrl:this.generateDeleteUrl(e),file:t}),this.hiddenField.value=this.getFilesValue()}appendParametersUrl(e){return new(ge())(e).toString()}generatePreviewUrl(e){const t=this.configService.getApiBaseUrl()+this.previewUrl.replace("__name__",e);return this.appendParametersUrl(t)}generateDeleteUrl(e){return this.configService.getApiBaseUrl()+this.deleteUrl.replace("__name__",e)}getFilesValue(){let e=this.handledFiles.map((e,t)=>e.name).join(", ");return"string"==typeof e?e:""}setUp(){this.logger.debug("setUp");let e={target:this.configService.getApiBaseUrl()+h.IMPORT_ASYNC_UPLOAD,chunkSize:524288},t=this.fileType.split(/\s*,\s*/).filter((e,t)=>""!==e.trim());this.fileInfo=t.map(e=>e.toLocaleUpperCase()).join(", "),e.fileType=t,this.hiddenField=this.platform.document.createElement("input"),this.hiddenField.type="hidden",this.hiddenField.name=this.name,this.element.appendChild(this.hiddenField),this.setFiles(this.value),this.resumable=new(ue())(e),this.resumable.support&&(this.browse.style.cursor="pointer",this.resumable.assignBrowse(this.browse,!1),this.resumable.assignDrop(this.drop),this.drop.addEventListener("dragover",this.onDragEnter),this.drop.addEventListener("dragenter",this.onDragEnter),this.drop.addEventListener("dragleave",this.onDragLeave),this.drop.addEventListener("drop",this.onDragLeave),this.resumable.on("fileAdded",this.onFileAdded),this.resumable.on("fileSuccess",this.onFileSuccess),this.resumable.on("fileProgress",this.onFileProgress),this.resumable.on("filesAdded",this.onFilesAdded),this.resumable.on("fileRetry",this.onFileRetry),this.resumable.on("fileError",this.onFileError),this.resumable.on("uploadStart",this.onUploadStart),this.resumable.on("complete",this.onComplete),this.resumable.on("progress",this.onProgress),this.resumable.on("error",this.onError),this.resumable.on("pause",this.onPause),this.resumable.on("beforeCancel",this.onBeforeCancel),this.resumable.on("cancel",this.onCancel),this.resumable.on("chunkingStart",this.onChunkingStart),this.resumable.on("chunkingProgress",this.onChunkingProgress),this.resumable.on("chunkingComplete",this.onChunkingComplete)),this.logger.debug("Attached")}setFiles(e){let t=e.split(/\s*,\s*/);this.handledFiles=t.filter((e,t)=>""!==e.trim()).map((e,t)=>({name:e,shortname:e.split(/.*[\/|\\]/).pop(),previewUrl:this.generatePreviewUrl(e),deleteUrl:this.generateDeleteUrl(e)}));const i=this.getFilesValue();this.hiddenField.value=i}setFile(e,t=null){this.handledFiles.forEach((e,t)=>{e.file&&null!==e.file&&this.resumable.removeFile(e.file)}),this.handledFiles=[{name:e,shortname:e.split(/.*[\/|\\]/).pop(),previewUrl:this.generatePreviewUrl(e),deleteUrl:this.generateDeleteUrl(e),file:t}];const i=this.getFilesValue();this.hiddenField.value=i}},(0,u.yV)(t,"File"),(()=>{const l="function"==typeof Symbol&&Symbol.metadata?Object.create(null):void 0;i=[(0,m._t)()],s=[(0,m._t)()],a=[(0,m._t)()],n=[(0,m._t)()],r=[(0,m._t)()],o=[(0,m._t)()],d=[(0,m._t)()],c=[(0,m._t)()],p=[(0,m._t)()],f=[(0,m._t)()],E=[(0,m._t)()],(0,u.G4)(null,null,i,{kind:"field",name:"fileType",static:!1,private:!1,access:{has:e=>"fileType"in e,get:e=>e.fileType,set:(e,t)=>{e.fileType=t}},metadata:l},C,F),(0,u.G4)(null,null,s,{kind:"field",name:"name",static:!1,private:!1,access:{has:e=>"name"in e,get:e=>e.name,set:(e,t)=>{e.name=t}},metadata:l},y,S),(0,u.G4)(null,null,a,{kind:"field",name:"multiple",static:!1,private:!1,access:{has:e=>"multiple"in e,get:e=>e.multiple,set:(e,t)=>{e.multiple=t}},metadata:l},w,L),(0,u.G4)(null,null,n,{kind:"field",name:"value",static:!1,private:!1,access:{has:e=>"value"in e,get:e=>e.value,set:(e,t)=>{e.value=t}},metadata:l},T,D),(0,u.G4)(null,null,r,{kind:"field",name:"imageWidth",static:!1,private:!1,access:{has:e=>"imageWidth"in e,get:e=>e.imageWidth,set:(e,t)=>{e.imageWidth=t}},metadata:l},_,x),(0,u.G4)(null,null,o,{kind:"field",name:"imageHeight",static:!1,private:!1,access:{has:e=>"imageHeight"in e,get:e=>e.imageHeight,set:(e,t)=>{e.imageHeight=t}},metadata:l},O,U),(0,u.G4)(null,null,d,{kind:"field",name:"title",static:!1,private:!1,access:{has:e=>"title"in e,get:e=>e.title,set:(e,t)=>{e.title=t}},metadata:l},M,N),(0,u.G4)(null,null,c,{kind:"field",name:"uploadFileText",static:!1,private:!1,access:{has:e=>"uploadFileText"in e,get:e=>e.uploadFileText,set:(e,t)=>{e.uploadFileText=t}},metadata:l},z,P),(0,u.G4)(null,null,p,{kind:"field",name:"uploadFileDnd",static:!1,private:!1,access:{has:e=>"uploadFileDnd"in e,get:e=>e.uploadFileDnd,set:(e,t)=>{e.uploadFileDnd=t}},metadata:l},R,j),(0,u.G4)(null,null,f,{kind:"field",name:"uploadFileDescription",static:!1,private:!1,access:{has:e=>"uploadFileDescription"in e,get:e=>e.uploadFileDescription,set:(e,t)=>{e.uploadFileDescription=t}},metadata:l},q,B),(0,u.G4)(null,null,E,{kind:"field",name:"error",static:!1,private:!1,access:{has:e=>"error"in e,get:e=>e.error,set:(e,t)=>{e.error=t}},metadata:l},G,H),(0,u.G4)(null,e={value:t},I,{kind:"class",name:t.name,metadata:l},null,A),t=e.value,l&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:l}),(0,u.zF)(t,A)})(),t})();void 0!==webpackBaseUrl&&(i.p=webpackBaseUrl);const ve=document.querySelector("body");d.Ay.register(s).register(o).register(c.JZ.customize(e=>{e.DefaultTrigger=c.tD.blur})).enhance({host:ve,component:class{constructor(e=(0,g.hd)(g.gF)){this.logger=e,this.logger=e.scopeTo("CmsApp")}binding(){this.logger.trace("binding")}attaching(){this.logger.trace("Attaching")}}})}},e=>{e.O(0,[96],()=>e(e.s=6565)),e.O()}]);